{"version":3,"sources":["wxgql.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["var responseHandler = function(resolve, reject, res, errorHandler) {\n    var retData = res.data.errors ? res.data.errors[0].message : {\n        code: 200\n    };\n    if(res.statusCode == 200 && retData.code ==200) {\n        resolve(res.data.data);\n    } else {\n        reject(res.data);\n        if (errorHandler) {\n            errorHandler(res.data);\n        }\n    }\n}\n\nvar GraphQL = function(obj, retObj) {\n\n    if (!obj.url) {\n        throw \"请提供GraphQL请求URL(.url)\"\n    }\n\n    retObj = retObj || false;\n\n    let header = {};\n\n    if (typeof obj.header === 'function') {\n      header = obj.header();\n    }\n\n    if (typeof obj.header === 'object') {\n      header = obj.header;\n    }\n\n    if(retObj) {\n        return {\n            query: function(queryObj) {\n                return new Promise(function(resolve, reject) {\n                    wx.request({\n                        url: obj.url,\n                        method: 'POST',\n                        data: JSON.stringify({\n                            query: queryObj.query,\n                            variables: queryObj.variables\n                        }),\n                        header: queryObj.header || header,\n                        complete: function(res) {\n                            responseHandler(resolve, reject, res,obj.errorHandler);\n                        }\n                    });\n                });\n            },\n\n            mutate: function(mutateObj) {\n                return new Promise(function(resolve, reject) {\n                    wx.request({\n                        url: obj.url,\n                        method: 'POST',\n                        data: JSON.stringify({\n                            query: mutateObj.mutation,\n                            variables: mutateObj.variables\n                        }),\n                        header: mutateObj.header || header,\n                        complete: function(res) {\n                            responseHandler(resolve, reject, res);\n                        }\n                    });\n                });\n            }\n        }\n    } else {\n        return function (_obj) {\n\n            if (!_obj.body) {\n                throw \"请提供GraphQL请求body\"\n            }\n\n            return wx.request({\n                url: obj.url,\n                method: 'POST',\n                data: JSON.stringify(_obj.body),\n                success: _obj.success,\n                fail: _obj.fail,\n                header: _obj.header || header,\n                complete: _obj.complete\n            });\n        }\n    }\n}\n\nmodule.exports = {\n    GraphQL: GraphQL\n}\n"]}